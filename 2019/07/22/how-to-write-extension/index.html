<!DOCTYPE html><html class="has-navbar-fixed-top"><head><meta charset="utf-8"><title>Writing an extension for Ameba linter - Crystal Ameba</title><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1"><link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/outdated-browser/1.1.5/outdatedbrowser.min.css"><meta name="description" content="A static code analysis tool for Crystal"><meta name="keywords" content="crystal linter"><meta name="description" content="It was announced recently that Ameba is going to be extendable. That means any developer can create his own extension and use together with Ameba’s engine. Here we will be following through the steps"><meta property="og:type" content="article"><meta property="og:title" content="Writing an extension for Ameba linter"><meta property="og:url" content="https://crystal-ameba.github.io/2019/07/22/how-to-write-extension/index.html"><meta property="og:site_name" content="Crystal Ameba"><meta property="og:description" content="It was announced recently that Ameba is going to be extendable. That means any developer can create his own extension and use together with Ameba’s engine. Here we will be following through the steps"><meta property="og:locale" content="en_US"><meta property="og:image" content="https://crystal-ameba.github.io/gallery/posts/how-to-write-extension/crystal-docs-ext.png"><meta property="article:published_time" content="2019-07-22T13:56:53.000Z"><meta property="article:modified_time" content="2025-07-28T09:11:53.475Z"><meta property="article:author" content="Vitalii Elenhaupt"><meta property="article:tag" content="extension"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="https://crystal-ameba.github.io/gallery/posts/how-to-write-extension/crystal-docs-ext.png"><meta name="twitter:creator" content="@veelenga"><link rel="icon" href="/favicon.png"><link rel="stylesheet" href="//fonts.googleapis.com/css?family=Ovo|Source+Code+Pro"><link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/bulma/0.6.2/css/bulma.min.css"><link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/lightgallery/1.6.8/css/lightgallery.min.css"><link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/justifiedGallery/3.6.5/css/justifiedGallery.min.css"><link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/atom-one-light.min.css"><link rel="stylesheet" href="/css/style.css"><script defer src="//use.fontawesome.com/releases/v5.0.8/js/all.js"></script><script async src="https://www.googletagmanager.com/gtag/js?id=UA-63584551-6"></script><script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","UA-63584551-6")</script><meta name="generator" content="Hexo 6.3.0">
<style>.not-gallery-item { position: relative; display: inline-block; width: 1.2em; min-height: 1.2em; overflow: hidden; vertical-align: top; color: transparent; }  .not-gallery-item > span { position: relative; z-index: 10; }  .not-gallery-item img, .not-gallery-item .fancybox { margin: 0 !important; padding: 0 !important; border: none !important; outline: none !important; text-decoration: none !important; user-select: none !important; cursor: auto !important; }  .not-gallery-item img { height: 1.2em !important; width: 1.2em !important; position: absolute !important; left: 50% !important; top: 50% !important; transform: translate(-50%, -50%) !important; user-select: none !important; cursor: auto !important; } .not-gallery-item-fallback { color: inherit; } .not-gallery-item-fallback img { opacity: 0 !important; }</style>
</head><body><nav class="navbar is-transparent is-fixed-top navbar-main" role="navigation" aria-label="main navigation"><div class="container"><div class="navbar-brand"><a class="navbar-item navbar-logo" href="/"><img src="/images/logo.png" alt="" height="28"></a><div class="navbar-burger"><span></span> <span></span> <span></span></div></div><div class="navbar-menu navbar-start"><a class="navbar-item" href="/blog">Blog</a> <a class="navbar-item" href="https://crystal-ameba.github.io/ameba/">Documentation</a></div><div class="navbar-menu navbar-end"><a class="navbar-item search" title="Search" href="javascript:;"><i class="fas fa-search"></i></a><div class="navbar-item is-hoverable has-dropdown is-hidden-mobile is-hidden-tablet-only toc"><a class="navbar-item" title="Table of Contents"><i class="fa fa-list"></i></a><div class="navbar-dropdown is-right"><a class="navbar-item" href="#1-New-extension-skeleton">1.1&nbsp;&nbsp;1. New extension skeleton</a> <a class="navbar-item" href="#2-Creating-a-rule">1.2&nbsp;&nbsp;2. Creating a rule</a> <a class="navbar-item" href="#3-Plug-in-the-extension">1.3&nbsp;&nbsp;3. Plug-in the extension</a><hr class="navbar-divider"><a class="navbar-item" href="#Wrap-up">2&nbsp;&nbsp;<b>Wrap up</b></a></div></div><a class="navbar-item" title="Edit on GitHub" target="_blank" rel="noopener" href="https://github.com/crystal-ameba/crystal-ameba.github.io/edit/site/source/_posts/how-to-write-extension.md"><i class="fas fa-edit"></i></a></div></div></nav><section class="section"><div class="container"><article class="article content gallery" itemscope itemprop="blogPost"><h1 class="article-title is-size-3 is-size-4-mobile" itemprop="name">Writing an extension for Ameba linter</h1><div class="article-meta columns is-variable is-1 is-multiline is-mobile is-size-7-mobile"><span class="column is-narrow article-category"><i class="far fa-folder"></i> <a class="article-category-link" href="/categories/Tutorial/">Tutorial</a></span></div><div class="article-entry is-size-6-mobile" itemprop="articleBody"><html><head></head><body><p>It was <a target="_blank" rel="noopener" href="https://github.com/crystal-ameba/ameba/pull/112">announced recently</a> that Ameba is going to be extendable. That means any developer can create his own extension and use together with Ameba’s engine.</p><p>Here we will be following through the steps on how to create such an extension and use it.</p><span id="more"></span><p>It is going to be <code>crystal-docs</code> extension, where a new rule will be implemented which will <strong>enforce classes to have documentation</strong>.</p><h3 id="1-New-extension-skeleton"><a href="#1-New-extension-skeleton" class="headerlink" title="1. New extension skeleton"></a>1. New extension skeleton</h3><p>Creating a new Ameba extension is as simple as creating a new Crystal library:</p><figure class="highlight sh hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ crystal init lib crystal-docs &amp;&amp; <span class="hljs-built_in">cd</span> crystal-docs</span><br></pre></td></tr></tbody></table></figure><p>and adding Ameba as a dependency to <code>shard.yml</code>:</p><figure class="highlight yml hljs"><figcaption><span>shard.yml</span></figcaption><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-attr">name:</span> <span class="hljs-string">ameba-docs</span></span><br><span class="line"><span class="hljs-attr">version:</span> <span class="hljs-number">0.1</span><span class="hljs-number">.0</span></span><br><span class="line"></span><br><span class="line"><span class="hljs-attr">authors:</span></span><br><span class="line">  <span class="hljs-bullet">-</span> <span class="hljs-string">Vitalii</span> <span class="hljs-string">Elenhaupt</span> <span class="hljs-string">&lt;velenhaupt@gmail.com&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="hljs-attr">crystal:</span> <span class="hljs-number">0.29</span><span class="hljs-number">.0</span></span><br><span class="line"></span><br><span class="line"><span class="hljs-attr">license:</span> <span class="hljs-string">MIT</span></span><br><span class="line"></span><br><span class="line"><span class="hljs-attr">development_dependencies:</span></span><br><span class="line">  <span class="hljs-attr">ameba:</span></span><br><span class="line">    <span class="hljs-attr">github:</span> <span class="hljs-string">crystal-ameba/ameba</span></span><br><span class="line">    <span class="hljs-attr">version:</span> <span class="hljs-string">~&gt;</span> <span class="hljs-number">0.10</span><span class="hljs-number">.0</span></span><br></pre></td></tr></tbody></table></figure><p>It needs to be a development dependency because we don’t want to force the end application to be dependent on a specific version of Ameba.</p><h3 id="2-Creating-a-rule"><a href="#2-Creating-a-rule" class="headerlink" title="2. Creating a rule"></a>2. Creating a rule</h3><p>Ameba enforces rules to be extended from <code>Rule::Base</code> entity and to be a class. Let’s create one:</p><figure class="highlight crystal hljs"><figcaption><span>src/ameba-docs.cr</span></figcaption><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-class"><span class="hljs-keyword">module</span> <span class="hljs-title">Ameba::Rule</span></span></span><br><span class="line">  VERSION = <span class="hljs-string">"0.1.0"</span></span><br><span class="line"></span><br><span class="line">  <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Docs</span> ‹ <span class="hljs-title">Base</span></span></span><br><span class="line">    properties <span class="hljs-keyword">do</span></span><br><span class="line">      description <span class="hljs-string">"Enforces public classes to be documented"</span></span><br><span class="line">    <span class="hljs-keyword">end</span></span><br><span class="line"></span><br><span class="line">    MSG = <span class="hljs-string">"Class must be documented"</span></span><br><span class="line"></span><br><span class="line">    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">test</span></span>(source)</span><br><span class="line">      <span class="hljs-symbol">AST:</span>:NodeVisitor.new <span class="hljs-keyword">self</span>, source</span><br><span class="line">    <span class="hljs-keyword">end</span></span><br><span class="line"></span><br><span class="line">    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">test</span></span>(source, node : <span class="hljs-symbol">Crystal:</span>:ClassDef)</span><br><span class="line">      <span class="hljs-keyword">return</span> <span class="hljs-keyword">unless</span> node.visibility.public?</span><br><span class="line"></span><br><span class="line">      doc = node.doc</span><br><span class="line">      issue_for(node, MSG) <span class="hljs-keyword">if</span> doc.<span class="hljs-literal">nil</span>? || doc.empty?</span><br><span class="line">    <span class="hljs-keyword">end</span></span><br><span class="line">  <span class="hljs-keyword">end</span></span><br><span class="line"><span class="hljs-keyword">end</span></span><br></pre></td></tr></tbody></table></figure><p>A couple of things are defined here:</p><ol><li><code>properties</code> defines a dsl for configurable rule properties. We only have a rule description.</li><li><code>MSG</code> defines a constant for the error message to be reported.</li><li><code>def test(source)</code> is an entry point of the rule. Here the method accepts a source file and passes it to the node visitor, which allows us filter the <code>ClassDef</code> nodes in the method below.</li><li><code>def test(source, node : Crystal::ClassDef)</code> is a method which does an actual job. The implementation is pretty self explained: it filters out node, which have public visibility and do not have (or have empty) docs.</li></ol><p>The extension is pretty much done. Let’s try to use it.</p><h3 id="3-Plug-in-the-extension"><a href="#3-Plug-in-the-extension" class="headerlink" title="3. Plug-in the extension"></a>3. Plug-in the extension</h3><p>Somewhere in a separate project we want to plug-in the ameba engine and the extension we made.</p><p>To do that, we need to add a development dependencies for both of this projects:</p><figure class="highlight yml hljs"><figcaption><span>shard.yml</span></figcaption><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-attr">development_dependencies:</span></span><br><span class="line">  <span class="hljs-attr">ameba:</span></span><br><span class="line">    <span class="hljs-attr">github:</span> <span class="hljs-string">crystal-ameba/ameba</span></span><br><span class="line">  <span class="hljs-attr">ameba-docs:</span></span><br><span class="line">    <span class="hljs-attr">github:</span> <span class="hljs-string">crystal-ameba/ameba-docs-rule-example</span></span><br></pre></td></tr></tbody></table></figure><p>Then we install those deps:</p><figure class="highlight sh hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ shards install</span><br><span class="line"></span><br><span class="line">Fetching https://github.com/veelenga/ameba.git</span><br><span class="line">Fetching https://github.com/crystal-ameba/ameba-docs-rule-example.git</span><br><span class="line">Installing ameba (0.10.0 at master)</span><br><span class="line">Installing ameba-docs (0.1.0 at master)</span><br></pre></td></tr></tbody></table></figure><p>It will create <code>bin/ameba.cr</code> file which is needed to built the ameba together with modules.</p><p>First, we need to enable the module:</p><figure class="highlight crystal hljs"><figcaption><span>bin/ameba.cr</span></figcaption><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">require</span> <span class="hljs-string">"ameba/cli"</span>  <span class="hljs-comment"># requires Ameba's cli</span></span><br><span class="line"><span class="hljs-keyword">require</span> <span class="hljs-string">"ameba-docs"</span> <span class="hljs-comment"># requires ameba docs extension</span></span><br></pre></td></tr></tbody></table></figure><p>And now we are ready to build and run it:</p><figure class="highlight sh hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ crystal build bin/ameba.cr -o bin/ameba</span><br><span class="line">$ bin/ameba</span><br></pre></td></tr></tbody></table></figure><p>The results are displayed below. <code>crystal-docs</code> extension in action:</p><img src="/gallery/posts/how-to-write-extension/crystal-docs-ext.png"><h2 id="Wrap-up"><a href="#Wrap-up" class="headerlink" title="Wrap up"></a>Wrap up</h2><p>We made a small Ameba extension and used that in a third-party project. Of course, this was just an example of the rule and not a production ready solution. However, it is a perfect example of the power of Ameba’s modules.</p><p>The sources <a target="_blank" rel="noopener" href="https://github.com/crystal-ameba/ameba-docs-rule-example">are availabe on Github</a>.</p></body></html></div><div class="columns is-variable is-1 is-multiline is-mobile"><span class="column is-narrow"><a class="tag is-light article-tag" href="/tags/extension/">#extension</a></span></div><div class="columns is-mobile is-multiline article-nav"><span class="column is-12-mobile is-half-desktop article-nav-prev"><a href="/2019/09/03/internals/">Ameba&#39;s internals</a> </span><span class="column is-12-mobile is-half-desktop is-hidden-mobile article-nav-next"></span></div></article><div class="comments"><h3 class="title is-4">Comments</h3><script>var disqus_config=function(){this.page.url="https://crystal-ameba.github.io/2019/07/22/how-to-write-extension/",this.page.identifier="2019/07/22/how-to-write-extension/",this.language="en"};!function(){var t=document,e=t.createElement("script");e.src="//crystal-ameba-github-io.disqus.com/embed.js",e.setAttribute("data-timestamp",+new Date),(t.head||t.body).appendChild(e)}()</script><div id="disqus_thread"><noscript>Please enable JavaScript to view the <a target="_blank" rel="noopener" href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript></div></div></div></section><footer class="footer"><div class="container"><div class="columns content"><div class="column is-narrow has-text-centered">&copy; 2025 Vitalii Elenhaupt&nbsp; Powered by <a href="http://hexo.io/" target="_blank">Hexo</a> & <a target="_blank" rel="noopener" href="http://github.com/ppoffice/hexo-theme-minos">Minos</a></div><div class="column is-hidden-mobile"></div><div class="column is-narrow"><div class="columns is-mobile is-multiline is-centered"><a class="column is-narrow has-text-black" title="GitHub" target="_blank" rel="noopener" href="https://github.com/crystal-ameba/crystal-ameba.github.io">GitHub</a></div></div></div></div></footer><script src="//cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script><script src="//cdnjs.cloudflare.com/ajax/libs/moment.js/2.22.2/moment-with-locales.min.js"></script><div id="outdated"><h6>Your browser is out-of-date!</h6><p>Update your browser to view this website correctly. <a id="btnUpdateBrowser" target="_blank" rel="noopener" href="http://outdatedbrowser.com/">Update my browser now</a></p><p class="last"><a href="#" id="btnCloseUpdateBrowser" title="Close">&times;</a></p></div><script src="//cdnjs.cloudflare.com/ajax/libs/outdated-browser/1.1.5/outdatedbrowser.min.js"></script><script>$(document).ready((function(){outdatedBrowser({bgColor:"#f25648",color:"#ffffff",lowerThan:"flex"})}))</script><script>window.FontAwesomeConfig={searchPseudoElements:!0},moment.locale("en-AU")</script><script src="//cdnjs.cloudflare.com/ajax/libs/lightgallery/1.6.8/js/lightgallery-all.min.js"></script><script src="//cdnjs.cloudflare.com/ajax/libs/justifiedGallery/3.6.5/js/jquery.justifiedGallery.min.js"></script><script>!function(e){e(document).ready((function(){"function"==typeof e.fn.lightGallery&&e(".article.gallery").lightGallery({selector:".gallery-item"}),"function"==typeof e.fn.justifiedGallery&&e(".justified-gallery").justifiedGallery()}))}(jQuery)</script><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.0/clipboard.min.js"></script><style>.hljs{position:relative}.hljs .clipboard-btn{float:right;color:#9a9a9a;background:0 0;border:none;cursor:pointer}.hljs .clipboard-btn:hover{color:#8a8a8a}.hljs>.clipboard-btn{display:none;position:absolute;right:4px;top:4px}.hljs:hover>.clipboard-btn{display:inline}.hljs>figcaption>.clipboard-btn{margin-right:4px}</style><script>$(document).ready((function(){$("figure.hljs").each((function(t,e){var a="code-"+t,r=e.querySelector(".code"),c=$('<button>Copy <i class="far fa-clipboard"></i></button>');r.id=a,c.addClass("clipboard-btn"),c.attr("data-clipboard-target-id",a);var n=e.querySelector("figcaption");n?n.append(c[0]):e.prepend(c[0])})),new ClipboardJS(".clipboard-btn",{target:function(t){return document.getElementById(t.getAttribute("data-clipboard-target-id"))}}).on("success",(function(t){t.clearSelection()}))}))</script><script src="/js/script.js"></script><div class="searchbox ins-search"><div class="searchbox-mask"></div><div class="searchbox-container ins-search-container"><div class="searchbox-input-wrapper"><input type="text" class="searchbox-input ins-search-input" placeholder="Type something..."> <span class="searchbox-close ins-close ins-selectable"><i class="fa fa-times-circle"></i></span></div><div class="searchbox-result-wrapper ins-section-wrapper"><div class="ins-section-container"></div></div></div></div><script>!function(T){T.INSIGHT_CONFIG={TRANSLATION:{POSTS:"Posts",PAGES:"Pages",CATEGORIES:"Categories",TAGS:"Tags",UNTITLED:"(Untitled)"},CONTENT_URL:"/content.json"}}(window)</script><script src="/js/insight.js"></script></body></html>